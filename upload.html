<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Upload Item - Online Flea Market</title>
<link rel="stylesheet" href="style.css">
</head>
<body>

<header>
    <h1>Online Flea Market</h1>
</header>

<nav>
    <button onclick="location.href='index.html'">Home</button>
    <button onclick="location.href='upload.html'">Upload</button>
    <button onclick="location.href='rules.html'">Rules</button>
</nav>

<div class="container">
<form id="uploadForm">
    <label>Name of Product:</label>
    <input type="text" id="productName" required><br><br>

    <label>Name of Seller:</label>
    <input type="text" id="sellerName" required><br><br>

    <label>Blok:</label>
    <input type="text" id="blok" required><br><br>

    <label>Phone Number:</label>
    <input type="text" id="phone" required><br><br>

    <label>Category of Product:</label>
    <select id="productCategory" required>
        <option value="Clothes">Clothes</option>
        <option value="Books">Books</option>
        <option value="Cosmetics">Cosmetics</option>
        <option value="Skin Care">Skin Care</option>
        <option value="Accessories">Accessories</option>
        <option value="Others">Others</option>
    </select><br><br>

    <label>Category of Service:</label>
    <select id="serviceCategory" required>
        <option value="Selling">Selling</option>
        <option value="Renting">Renting</option>
    </select><br><br>

    <label>Price (RM):</label>
    <input type="number" id="price" min="2" max="100" required><br><br>

    <label>Description:</label><br>
    <textarea id="description" rows="4" cols="50"></textarea><br><br>

    <label>Upload Image:</label>
    <input type="file" id="image" accept="image/*" required><br><br>

    <button type="submit">Upload Item</button>
</form>
</div>

<script type="module">
import { db, storage } from './firebase.js';
import { collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";
import { ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-storage.js";

const uploadForm = document.getElementById("uploadForm");

uploadForm.addEventListener("submit", async (e) => {
    e.preventDefault();

    const productName = document.getElementById("productName").value.trim();
    const sellerName = document.getElementById("sellerName").value.trim();
    const blok = document.getElementById("blok").value.trim();
    const phone = document.getElementById("phone").value.trim();
    const productCategory = document.getElementById("productCategory").value;
    const serviceCategory = document.getElementById("serviceCategory").value;
    const price = parseFloat(document.getElementById("price").value);
    const description = document.getElementById("description").value;
    const imageInput = document.getElementById("image");

    if (!imageInput.files[0]) {
        alert("Please upload an image");
        return;
    }

    // Upload image to Firebase Storage
    const imageFile = imageInput.files[0];
    const imageRef = ref(storage, `productImages/${Date.now()}_${imageFile.name}`);
    await uploadBytes(imageRef, imageFile);
    const imageUrl = await getDownloadURL(imageRef);

    // Add product to Firestore
    await addDoc(collection(db, "products"), {
        productName,
        sellerName,
        blok,
        phone,
        productCategory,
        serviceCategory,
        price,
        description,
        imageUrl,
        createdAt: serverTimestamp()
    });

    alert("Item uploaded successfully!");
    window.location.href = "index.html";
});
</script>

</body>
</html>





