<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Upload Item - Online Flea Market</title>
<link rel="stylesheet" href="style.css">
</head>
<body>

<header>
    <h1>Online Flea Market</h1>
</header>

<nav>
    <button onclick="location.href='index.html'">Home</button>
    <button onclick="location.href='upload.html'">Upload</button>
    <button onclick="location.href='rules.html'">Rules</button>
</nav>

<div class="container">
<form id="uploadForm">
    <label>Name of Product:</label>
    <input type="text" id="productName" required><br><br>

    <label>Name of Seller:</label>
    <input type="text" id="sellerName" required><br><br>

    <label>Blok:</label>
    <input type="text" id="blok" required><br><br>

    <label>Phone Number:</label>
    <input type="text" id="phone" required><br><br>

    <label>Category of Product:</label>
    <select id="productCategory" required>
        <option value="Clothes">Clothes</option>
        <option value="Books">Books</option>
        <option value="Cosmetics">Cosmetics</option>
        <option value="Skin Care">Skin Care</option>
        <option value="Accessories">Accessories</option>
        <option value="Others">Others</option>
    </select><br><br>

    <label>Category of Service:</label>
    <select id="serviceCategory" required>
        <option value="Selling">Selling</option>
        <option value="Renting">Renting</option>
    </select><br><br>

    <label>Price (RM):</label>
    <input type="number" id="price" min="2" max="100" required><br><br>

    <label>Description:</label><br>
    <textarea id="description" rows="4" cols="50"></textarea><br><br>

    <label>Upload Image:</label>
    <input type="file" id="image" accept="image/*" required><br><br>

    <button type="submit">Upload Item</button>
</form>
</div>

<!-- Firebase CDN -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-storage.js"></script>

<script>
  // Initialize Firebase
  const firebaseConfig = {
    apiKey: "AIzaSyBTSEX-KMCddwLaKNCSEvEI0OQr58uayyg",
    authDomain: "we0023-59d22.firebaseapp.com",
    projectId: "we0023-59d22",
    storageBucket: "we0023-59d22.firebasestorage.app",
    messagingSenderId: "443902240610",
    appId: "1:443902240610:web:a649d92142e78c51b3ee3b"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();
  const storage = firebase.storage();

  const uploadForm = document.getElementById("uploadForm");

  uploadForm.addEventListener("submit", async function(e) {
    e.preventDefault();

    const productName = document.getElementById("productName").value.trim();
    const sellerName = document.getElementById("sellerName").value.trim();
    const blok = document.getElementById("blok").value.trim();
    const phone = document.getElementById("phone").value.trim();
    const productCategory = document.getElementById("productCategory").value;
    const serviceCategory = document.getElementById("serviceCategory").value;
    const price = parseFloat(document.getElementById("price").value);
    const description = document.getElementById("description").value;
    const imageInput = document.getElementById("image");

    if (!imageInput.files[0]) {
      alert("Please upload an image");
      return;
    }

    const imageFile = imageInput.files[0];
    const storageRef = storage.ref('productImages/' + Date.now() + '_' + imageFile.name);
    
    // Upload image to Firebase Storage
    storageRef.put(imageFile).then(() => {
      storageRef.getDownloadURL().then((url) => {
        // Save product to Firestore
        db.collection("products").add({
          productName,
          sellerName,
          blok,
          phone,
          productCategory,
          serviceCategory,
          price,
          description,
          imageUrl: url,
          createdAt: firebase.firestore.FieldValue.serverTimestamp()
        }).then(() => {
          alert("Item uploaded successfully!");
          window.location.href = "index.html";
        }).catch(err => {
          console.error(err);
          alert("Error uploading product.");
        });
      });
    }).catch(err => {
      console.error(err);
      alert("Error uploading image.");
    });
  });
</script>

</body>
</html>







